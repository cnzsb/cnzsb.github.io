<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>HTML5 图片预览 | 奔跑的Q丶</title>

  
  <meta name="author" content="赵世博">
  

  
  <meta name="description" content="主题凑合用，样式即将改版...">
  

  
  
  <meta name="keywords" content="HTML5">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="HTML5 图片预览"/>

  <meta property="og:site_name" content="奔跑的Q丶"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="奔跑的Q丶" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">奔跑的Q丶</a>
    </h1>
    <p class="site-description">主题凑合用，样式即将改版...</p>
    <div class="site-navigation contact-me">
        <ul>
          
            <li><a class="icon-github" href="http://github.com/cnzsb" target="_blank"></a></li>
          
            <li><a class="icon-weibo" href="http://weibo.com/u/2821242461" target="_blank"></a></li>
          
            <li><a class="icon-mail" href="mailto:cnzsb@foxmail.com" target="_blank"></a></li>
          
            <li><a class="icon-rss" href="/atom.xml" target="_blank"></a></li>
          
        </ul>
    </div>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/mydemo">Demo</a></li>
      
    </ul>
  </nav>
</header>


    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>HTML5 图片预览</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2016/08/29/HTML5 图片预览/" rel="bookmark">
        <time class="entry-date published" datetime="2016-08-29T14:43:12.000Z">
          2016-08-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>在没有 HTML5 之前，前端的图片预览都是在用户选择图片后就发 Ajax 到服务端，然后由服务端再把图片的 URL 返还给前端来完成的。有了 HTML5 后，在 IE10 以上及代浏览器的版本中我们便无须发请求获得 URL 来完成预览了。这些将依靠 <code>FileReader</code> 来实现。</p>
<a id="more"></a>
<p>我们直接来实现一个 demo，可以点击尝试一下。</p>
<p><input id="file" type="file" accept="image/jpg, image/jpeg, image/png, image/gif"></p>
<div id="preview"></div>

<script>
var file = document.getElementById('file'),
    preview = document.getElementById('preview');
file.addEventListener('change', function(e) {
    var file = e.target.files[0],
        fr = new FileReader();
    fr.onload = function(e) {
        var img = e.target.result;
        preview.innerHTML = '<img src="' + img + '" width="200" height="200">';
    };
    fr.readAsDataURL(file);
}, false);
</script>


<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"file"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">accept</span>=<span class="string">"image/jpg, image/jpeg, image/png, image/gif"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"preview"</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">width</span>=<span class="string">"200"</span> <span class="attr">height</span>=<span class="string">"200"</span> <span class="attr">style</span>=<span class="string">"display: none"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript"><span class="keyword">var</span> file = <span class="built_in">document</span>.getElementById(<span class="string">'file'</span>),</span></div><div class="line"><span class="javascript">    preview = <span class="built_in">document</span>.getElementById(<span class="string">'preview'</span>);</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="actionscript">file.addEventListener(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> </span>&#123;</span></div><div class="line"><span class="actionscript">    <span class="keyword">var</span> file = e.target.files[<span class="number">0</span>],</span></div><div class="line"><span class="actionscript">        fr = <span class="keyword">new</span> FileReader();</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="actionscript">    fr.onload = <span class="function"><span class="keyword">function</span><span class="params">(e)</span> </span>&#123;</span></div><div class="line"><span class="undefined">        preview.src = e.target.result;</span></div><div class="line"><span class="actionscript">        preview.style.display = <span class="string">'block'</span>;</span></div><div class="line"><span class="undefined">    &#125;;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    fr.readAsDataURL(file);</span></div><div class="line"><span class="actionscript">&#125;, <span class="literal">false</span>);</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>我们用 <code>FileReader</code> 的一个实例利用方法 <code>readAsDataURL</code> 读取了上传的文件，并且我们事先设置了在读取即 <code>onload</code> 时，触发了视图更新。</p>
<p><code>FileReader</code> 的这个特性，主要是把上传的图片给转化为了 <code>base64</code> 的格式，因此实现了预览。其实它还可以读取 <code>Blob</code> 和 <code>File</code> 等文件，具体的方法可以看<a href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader" target="_blank" rel="external">这里</a>。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/HTML5/">HTML5</a>
    </span>
    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2017 赵世博
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-71274501-1', 'auto');
    ga('send', 'pageview');

</script>

  </div>
</div>
</body>
</html>